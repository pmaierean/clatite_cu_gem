#
#  Licensed to the Apache Software Foundation (ASF) under one
#  or more contributor license agreements.  See the NOTICE file
#  distributed with this work for additional information
#  regarding copyright ownership.  The ASF licenses this file
#  to you under the Apache License, Version 2.0 (the
#  "License"); you may not use this file except in compliance
#  with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
#  Unless required by applicable law or agreed to in writing,
#  software distributed under the License is distributed on an
#  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
#  KIND, either express or implied.  See the License for the
#  specific language governing permissions and limitations
#  under the License.
[feature name=maiereni]

[variables]
    ehcache.version=3.7.0
# [artifacts]
#  org.owasp.esapi/esapi-bundle/2.1.0.1
  	
[artifacts]
  org.apache.sling/org.apache.sling.resourceaccesssecurity/1.0.1-SNAPSHOT
  	
[artifacts startLevel=30]
  javax.cache/cache-api/1.1.0
  org.ehcache/ehcache/${ehcache.version}
  org.ehcache.modules/ehcache-api/${ehcache.version}
  # org.ehcache.modules/ehcache-core/${ehcache.version}
  # org.ehcache.modules/ehcache-impl/${ehcache.version}
  org.ehcache.modules/ehcache-xml/${ehcache.version}
  # org.ehcache.modules/ehcache-107/${ehcache.version}
  org.ehcache/ehcache-clustered/${ehcache.version}
  org.ehcache/ehcache-transactions/${ehcache.version}
  com.maiereni.sling/AuthenticationHandler/1.0.0-SNAPSHOT
  com.maiereni.sling/GitSynchronizer/1.0.0-SNAPSHOT
    
[:repoinit]
    create service user authentication-handler

    set ACL for authentication-handler
        allow    jcr:all     on /
    end
    
    create service user synchronization-handler

    set ACL for synchronization-handler
        allow    jcr:all     on /
    end
    
    
[configurations]
  org.apache.sling.commons.log.LogManager.factory.config-maiereni-jaas.log
	org.apache.sling.commons.log.additiv=B"false"
	org.apache.sling.commons.log.file="logs/mySpecial.log"
	org.apache.sling.commons.log.level="debug"
	org.apache.sling.commons.log.names=[ "com.maiereni.jaas.handler", "com.maiereni.authentication.handler", "com.maiereni.authorization.handler" , "com.maiereni.authorization.handler.impl" , "com.maiereni.authorization.cmd"]
	org.apache.sling.commons.log.pattern="{0,date,dd.MM.yyyy\ HH:mm:ss.SSS}\ *{4}*\ [{2}]\ {3}\ {5}"

  com.maiereni.authentication.cache.CacheManagerBuilderImpl-config
  	heap.pool.size=100L
  	disk.storage="/opt/local/cache/sling"
  
  com.maiereni.synchronizer.git.service.GitSynchronizerService-config
    update.expression="0 0/5 * * * ?"
    git.remote="https://bitbucket.org/maiereni/website.git"
    git.credentials="user\=maiereni,password\=zG14#23A"
    git.local.repo="/opt/local/git"

  org.apache.sling.commons.log.LogManager.factory.config-maiereni-git.log
	org.apache.sling.commons.log.additiv=B"false"
	org.apache.sling.commons.log.file="logs/gitSynchronizer.log"
	org.apache.sling.commons.log.level="debug"
	org.apache.sling.commons.log.names=[ "com.maiereni.synchronizer.git.service.impl", "com.maiereni.util", "com.maiereni.synchronizer.jcr.utils" ]
	org.apache.sling.commons.log.pattern="{0,date,dd.MM.yyyy\ HH:mm:ss.SSS}\ *{4}*\ [{2}]\ {3}\ {5}"

  # configure the ScriptCache for scripts used by com.maiereni.sling/AuthenticationHandler
  org.apache.sling.serviceusermapping.impl.ServiceUserMapperImpl.amended-authenticationHandler
     user.mapping=[
          "com.maiereni.sling.AuthenticationHandler:PermissionService\=authentication-handler",
          "com.maiereni.sling.GitSynchronizer:GitSynchronizerService\=synchronization-handler"
     ]
 
  